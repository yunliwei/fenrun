<!DOCTYPE html>
<html>
	<head>
		 <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>订单管理</title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="js/juqerysession.js"></script>
		<script>


			$(document).ready(function(){

				if ($.session.get('userid') == undefined) {

					location.href = "login.html"
				}
				else {

					var btn = document.getElementById("quanbu");

					btn.addEventListener("tap",function () {
						$('#list').empty()
						order(0)
					});

					var btn = document.getElementById("daifukuan");

					btn.addEventListener("tap",function () {
						$('#list1').empty()
                      order(1)
					});

					var btn = document.getElementById("daishouhuo");

					btn.addEventListener("tap",function () {


						order(2)
					});

					var btn = document.getElementById("daifahuo");

					btn.addEventListener("tap",function () {


						order(3)
					});

					var btn = document.getElementById("daipingjia");

					btn.addEventListener("tap",function () {


						order(4)
					});

                 }

function order(status){


	mui.getJSON('http://localhost:3000//mobiles/orderdetail', {userid: ($.session.get('userid')),status:status}, function (data) {
		//$('#list').val("")



		$.each(data.order, function (i, itemorder) {
			var itemHtml =
					'<div class="mui-card" style="width: 100%;" id='+itemorder.id+'>' +
						<!--页眉，放置标题-->
					'</div>';

			$.each(data.type, function (i, itemtype) {
				if (itemtype.state == 1) {
					alert(itemorder.state)
					$('#list1').append(itemHtml)
				}
				else if (itemorder.state != "") {
//alert(itemorder.state)
//
					$('#list').append(itemHtml)
				}

			});
			$.each(data.ware, function (i, itemware) {
//									alert("oo")
									var itemhtml =

										<!--页眉，放置标题-->
											'<div class="mui-card-header" style="height: 25px;">' + itemware.ware +
											'<p style=" color: red; float: right;">交易成功</p>' +
											'</div>' +
												<!--内容区-->
											'<div class="mui-card-header mui-card-media">' +
											'<img  src= "/warepictures/' + itemware.id + '/' + itemware.warepicture_file_name + '" />' +
											'<div class="mui-media-body" ' + 'id=' + itemware.id + '>' +
											itemware.ware +
											'<p>￥' + itemorder.sum +
											'<p>创建于:' + itemorder.created_at + '</p>' +
											'</div>' +
											'</div>';


									if (itemware.id == itemorder.ware_id) {
										$("#" + itemorder.id).append(itemhtml)
									}

								});

								var httttt =

									<!--页脚，放置补充信息或支持的操作-->
										'<div class="mui-card-footer" style="float: right; margin-right: 5px;">' +

										'<button type="button" class="mui-btn">删除订单</button>' +

										'<button style="margin-right: 5px;"type="button" class="mui-btn">追加评价</button>' +

										'</div>';

								$("#" + itemorder.id).append(httttt)



							});


						})
					}





			});
		</script>
	</head>
	<body>
		
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">订单管理</h1>
		</header>
		<div class="mui-content">
		
		        <div class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
		            <a class="mui-control-item mui-active" href="#item1mobile" id="quanbu">全部</a>
		            <a class="mui-control-item" href="#item2mobile" id="daifukuan">待付款</a>
		            <a class="mui-control-item" href="#item3mobile" id="daishouhuo">待发货</a>
		             <a class="mui-control-item" href="#item4mobile" id="daifahuo">待收货</a>
		            <a class="mui-control-item"  href="#item5mobile" id="daipingjia">待评价</a>
		        </div>
		        
		        <div class="mui-slider-group">
		            <div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
		                <ul class="mui-table-view" id="list">

		                </ul>
		            </div>

		            <div  class="mui-slider-item mui-control-content"  id="item2mobile">


						<ul class="mui-table-view" id="list1">

						</ul>
	                    
		            </div>
		            <div class="mui-slider-item mui-control-content" id="item3mobile">
						<ul class="mui-table-view" id="list2">

						</ul>
		            </div>
		             <div id="item4mobile" class="mui-slider-item mui-control-content">
						 <ul class="mui-table-view" id="list3">

						 </ul>
		            </div>
		             <div id="item5mobile" class="mui-slider-item mui-control-content">
						 <ul class="mui-table-view" id="list4">

						 </ul>
		            </div>
		        </div>
		   
		</div>
		
	
		 <script>




    </script>
	</body>
</html>
